.\" Automatically generated by Pod::Man 2.22 (Pod::Simple 3.13)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "KRB5-SYNC-BACKEND 1"
.TH KRB5-SYNC-BACKEND 1 "2010-02-15" "2.0" "krb5-sync"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
krb5\-sync\-backend \- Manipulate Kerberos password and status change queue
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBkrb5\-sync\-backend\fR \fB\-h\fR
.PP
\&\fBkrb5\-sync\-backend\fR (disable|enable) \fIuser\fR
.PP
\&\fBkrb5\-sync\-backend\fR (help|list)
.PP
\&\fBkrb5\-sync\-backend\fR [\fB\-s\fR] process
.PP
\&\fBkrb5\-sync\-backend\fR password \fIuser\fR ad \fIpassword\fR
.PP
\&\fBkrb5\-sync\-backend\fR purge \fIdays\fR
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBkrb5\-sync\-backend\fR provides an interface to the queue of pending
password and account status changes written by either this utility or by
the synchronization plugin after failures.  It can queue account enables,
disables, or password changes for Active Directory, list the queued
actions, or process the queued actions with \fBkrb5\-sync\fR (telling it to
take its action from a file).
.PP
The queue directory will contain files with names in the format:
.PP
.Vb 1
\&    <username>\-<domain>\-<action>\-<timestamp>\-<count>
.Ve
.PP
where <username> is the name of the affected account (\f(CW\*(C`/\*(C'\fR will be
replaced with \f(CW\*(C`.\*(C'\fR in the file name and the realm will be removed),
<domain> is \f(CW\*(C`ad\*(C'\fR, <action> is either \f(CW\*(C`enable\*(C'\fR (used for both enabling
and disabling accounts) or \f(CW\*(C`password\*(C'\fR, <timestamp> is a \s-1ISO\s0 8601
timestamp in \s-1UTC\s0, and <count> is a two-digit zero-padded number between 0
and 99 (so that we can handle multiple changes that arrive in the same
second).  Each file contains a queued change in the format described in
\&\fIkrb5\-sync\fR\|(8).
.PP
Supported arguments to \fBkrb5\-sync\-backend\fR are:
.IP "disable \fIuser\fR" 4
.IX Item "disable user"
Queue a disable action (in Active Directory, as that's the only system
currently supported for enable and disable) for \fIuser\fR.
.IP "enable \fIuser\fR" 4
.IX Item "enable user"
Queue an enable action (in Active Directory, as that's the only system
currently supported for enable and disable) for \fIuser\fR.
.IP "help" 4
.IX Item "help"
List the supported commands.
.IP "list" 4
.IX Item "list"
List the current contents of the queue.
.IP "process" 4
.IX Item "process"
Process the queue.  All queued actions will be sorted alphanumerically
(which due to the timestamp means that all changes for a particular user of
a particular type will be done in the order queued).  \fBkrb5\-sync\fR will be
called for each queued action, as long as it continues to succeed.  If it
fails for a queued action, all other actions sharing the same username,
domain, and action will be skipped and queue processing will continue with
the next action that differs in one of those three parameters.
.IP "password \fIuser\fR ad \fIpassword\fR" 4
.IX Item "password user ad password"
Queue a password change for \fIuser\fR in Active Directory, setting their
password to \fIpassword\fR.  Note that \fIpassword\fR appears on the command
line, so you don't want to invoke this command in any environment where an
untrusted user would be in a position to see the command-line arguments of
processes (which are generally readable to anyone on the system).
.IP "purge \fIdays\fR" 4
.IX Item "purge days"
Delete all queued actions last modified longer than \fIdays\fR days ago.  This
can be used to clean up old failed change propagations in situations where
accounts may be created or have password changes queued that are later
removed and never created in other environments.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-h\fR, \fB\-\-help\fR" 4
.IX Item "-h, --help"
Display this documentation (by running this script through \f(CW\*(C`perldoc \-t\*(C'\fR and
exit.  All other options and commands are ignored.
.IP "\fB\-s\fR, \fB\-\-silent\fR" 4
.IX Item "-s, --silent"
When running the process command, filter out the output of \fBkrb5\-sync\fR to
ignore common errors and success messages and only show uncommon errors.
This option will filter out all output when \fBkrb5\-sync\fR is successful and
will filter out error messages matching:
.Sp
.Vb 2
\&    ^AD password change for \eS+ failed \e(3\e):.*Authentication error$
\&    ^AD status change for \eS+ failed \e(1\e): user .* not found in \eS+$
.Ve
.Sp
even when it fails.  (This message generally means the account doesn't exist
in Active Directory.)  The regexes can be modified at the start of this
script.
.SH "FILES"
.IX Header "FILES"
.IP "\fI/usr/sbin/krb5\-sync\fR" 4
.IX Item "/usr/sbin/krb5-sync"
The path to the \fBkrb5\-sync\fR utility.  This may be changed at the top of
this script.
.IP "\fI/var/spool/krb5\-sync\fR" 4
.IX Item "/var/spool/krb5-sync"
The default path to the queue.  This must match the queue_dir parameter in
\&\fIkrb5.conf\fR used by the plugin.  It can be changed at the top of this
script.
.IP "\fI/var/spool/krb5\-sync/.lock\fR" 4
.IX Item "/var/spool/krb5-sync/.lock"
An empty file used for locking the queue.  When writing to or querying the
queue, \fBkrb5\-sync\-backend\fR will open and lock this file with the Perl flock
function, which normally calls \fIflock\fR\|(2).  Any other queue writers need to
use the same locking mechanism for safe operation.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIkrb5\-sync\fR\|(8)
.PP
The current version of this program is available from its web page at
<http://www.eyrie.org/~eagle/software/krb5\-sync/>.
.SH "AUTHOR"
.IX Header "AUTHOR"
Russ Allbery <rra@stanford.edu>
